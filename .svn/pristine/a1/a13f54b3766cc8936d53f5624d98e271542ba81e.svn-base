<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<%@ page pageEncoding="UTF-8" contentType="text/html; charset=UTF-8" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt"  prefix="f" %>

<html lang="pt-br">
	<head>
		<link rel="stylesheet" type="text/css" media="screen" href="../css/smart_wizard.css">
		
		<script type="text/javascript" src="../js/jquery.smartWizard.js"></script>
		
		<script id="template" type="text/x-kendo-template">
			<img src="../imagens/hotel/#=target.data('id')#.jpg" alt="#=target.data('title')#" />
			<p>#=target.data('title')#</p>
		</script>
		
		<script type="text/javascript">
			$(document).ready(function(){
				kendo.culture("pt-BR");
				$("#wizardReserva").smartWizard({transitionEffect:'slideleft',onLeaveStep:leaveAStepCallback,onFinish:onFinishCallback,enableFinishButton:false});

				var options = {position: {x:'center', y:'top'}, lang: 'hr', errorMessages: {hr: {'required': '<f:message key="campo.obrigatorio"/>' }}};
			    
				$("#formReserva").bValidator(options);
				
				$("#rgReserva").mask("99.999.999-9");
				$("#cpfReserva").mask("999.999.999-99");
				$("#telefoneReserva").mask("(99) 99999-9999");

				$("#checkInReserva").datetimepicker({lang:'pt', format:'d/m/Y H:i'});
				$("#checkOutReserva").datetimepicker({lang:'pt', format:'d/m/Y H:i'});
				
				$("#imagens").kendoTooltip({
					filter: "a",
					content: kendo.template($("#template").html()),
					width: 400,
					height: 200,
					position: "top"
				});
				
				function leaveAStepCallback(obj){
					var step_num= obj.attr('rel');
					return validateSteps(step_num);
				}
				
				function onFinishCallback() {
					if(validateAllSteps()){
						$("#cadastrarReserva").waitMe({effect :'ios', text :'', bg :'rgba(255,255,255,0.5)', color :'#000', sizeW :'', sizeH :''});
						$.ajax({
							contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
							type: "POST",
							url: "<c:url value="/reserva/gravar"/>",
							data: $("#formReserva").serialize(),
							success: function(retorno) {
										$("#cadastrarReserva").data("kendoWindow").destroy();
										$("#conteudo").waitMe({effect :'ios', text :'', bg :'rgba(255,255,255,0.5)', color :'#000', sizeW :'', sizeH :''});
										$("#conteudo").load("<c:url value="/sistema/acomodacao/pesquisar"/>");
										$("#listaReserva").waitMe({effect :'ios', text :'', bg :'rgba(255,255,255,0.5)', color :'#000', sizeW :'', sizeH :''});
										$("#listaReserva").load("<c:url value="/reserva/sistema/lista"/>");
									 }
						});
					}
				}
			});
			
			function validateAllSteps(){
				var isStepValid = true;
				if(validateStep1() == false){
					isStepValid = false;
					$('#wizard').smartWizard('setError',{stepnum:1,iserror:true});
				} else {
					$('#wizard').smartWizard('setError',{stepnum:1,iserror:false});
				}
				if(validateStep2() == false){
					isStepValid = false;
					$('#wizard').smartWizard('setError',{stepnum:2,iserror:true});
				} else {
					$('#wizard').smartWizard('setError',{stepnum:2,iserror:false});
				}
				if(validateStep3() == false){
			        isStepValid = false;
			        $('#wizard').smartWizard('setError',{stepnum:3,iserror:true});
			   	} else {
			    	$('#wizard').smartWizard('setError',{stepnum:3,iserror:false});
			   	}
			   	if(!isStepValid){
					$('#wizard').smartWizard('showMessage','<f:message key= "mensagem.preencherCampos"/>');
				}
				return isStepValid;
			}

			function validateSteps(step){
				var isStepValid = true;
				if(step == 1){ // validar step 1
					if(validateStep1() == false ){
						isStepValid = false;
						$('#wizard').smartWizard('setError',{stepnum:step,iserror:true});
					} else {
						$('#wizard').smartWizard('hideMessage');
						$('#wizard').smartWizard('setError',{stepnum:step,iserror:false});
						
						var checkIn = $("#checkInReserva").val();
						var checkOut = $("#checkOutReserva").val();
						
						$("#acomodacaoReservaList").load(caminhoAbsoluto + "reserva/acomodacao/pesquisar", {dataCheckIn: checkIn, dataCheckOut: checkOut});
						
						$("#exibirCheckInReserva").val($("#checkInReserva").val());
			          	$("#exibirCheckOutReserva").val($("#checkOutReserva").val());
					}
				}
				
				if(step == 2){
					if(validateStep2() == false ){
						isStepValid = false;
						$('#wizard').smartWizard('setError',{stepnum:step,iserror:true});
					} else {
						$('#wizard').smartWizard('hideMessage');
						$('#wizard').smartWizard('setError',{stepnum:step,iserror:false});
						var id = $("#acomodacaoReserva").val();
			          	
						$.ajax({
							contentType: 'application/x-www-form-urlencoded; charset=UTF-8',
							type: "GET",
							url: caminhoAbsoluto + "reserva/acomodacao/atualizaDados/" + id,
							success: function(retorno){
										if (retorno != "") {
											retorno = retorno.split("],[");
											$("#exibirNomeReserva").val(retorno[0]);
											$("#exibirNumeroReserva").val(retorno[1] + " " + " -");
											$("#exibirValorTotalReserva").val(retorno[4]);
										} else
											$("#numero").empty().append("Acomodação não Encontrada");
									 }
						});
					}
				}
				
			  	if(step == 3){ // validate step3
			        if(validateStep3() == false ){
			            isStepValid = false;
			          	$('#wizard').smartWizard('setError',{stepnum:step,iserror:true});
			        } else {
			          	$('#wizard').smartWizard('hideMessage');
			          	$('#wizard').smartWizard('setError',{stepnum:step,iserror:false});
			          	$("#exibirResponsavelReserva").val($("#nomeResponsavelReserva").val());
			        }
			  	}
				return isStepValid;
			}

			function validateStep1(){
				var isValid = true;
				var un = $('#checkInReserva').val();
				if (!un && un.length <= 0){ // Validate CheckIn
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#checkInReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#checkInReserva"));
				}
				
				var pw = $('#checkOutReserva').val();
				if(!pw && pw.length <= 0){ // validate CheckOut
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#checkOutReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#checkOutReserva"));
				}
				return isValid;
			}

			function validateStep2(){
				var isValid = true; 
				var un = $('#acomodacaoReserva').val();
				if(!un && un.length <= 0){ // Validate Acomodacao
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#acomodacaoReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#acomodacaoReserva"));
				}
				return isValid;
			}

			function validateStep3(){
			  	var isValid = true;
				var un = $('#nomeResponsavelReserva').val();
				if (!un && un.length <= 0){ // Validate Responsavel
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#nomeResponsavelReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#nomeResponsavelReserva"));
				}

				var un2 = $('#sexoReserva').val();
				if (!un2 && un2.length <= 0){ // Validate Responsavel
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#sexoReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#sexoReserva"));
				}
				
				var un3 = $('#rgReserva').val();
				if (!un3 && un3.length <= 0){ // Validate Responsavel
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#rgReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#rgReserva"));
				}
				
				var un4 = $('#cpfReserva').val();
				if (!un4 && un4.length <= 0){ // Validate Responsavel
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#cpfReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#cpfReserva"));
				}
				
				var un5 = $('#telefoneReserva').val();
				if (!un5 && un5.length <= 0){ // Validate Responsavel
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#telefoneReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#telefoneReserva"));
				}
				
				var un6 = $('#emailReserva').val();
				if (!un6 && un6.length <= 0){ // Validate Responsavel
					isValid = false;
					$("#formReserva").data("bValidators").first.showMsg($("#emailReserva"), '<f:message key="campo.obrigatorio"/>');
				} else {
					$("#formReserva").data("bValidators").first.removeMsg($("#emailReserva"));
				}
			  	return isValid;
			}

			function maisInfoAcomodacao2 () {
				var w = $("<div id='" + this.id + "'></div>").appendTo("#container");
				w.kendoWindow({
				  	modal: true,
			        position: {
			    		top: 200,
			    		left: 500,
				  	},
			        resizable: false,
			        visible: false,
			    //    content: url,
			        actions: ["Close"],
			        close: function() {
						w.data("kendoWindow").destroy();
			        }
			    });
			    w.data("kendoWindow").open();
			}
		</script>
		<style type="text/css">
			.divForm {
				margin-left: 15px;
				margin-right: 15px;
				margin-top: 0px;
				margin-bottom: 0px;
			}
		</style>
	</head>
	<body class="divConteudo">
		<div class="demoHead" style="margin-left: 15px; margin-right: 15px;">
			<form id="formReserva" name="formReserva" action="#">
		  		<div id="wizardReserva" class="swMain" style="width: 616px;">
					<div class="form" style="height: 200px;">
						<h2 class="StepTitle" style="margin: 0px;">
							<img class="linkSemBorda" src="../imagens/icones/iconePeriodo.png" style="margin-left: 5px; height: 12px;"/> <f:message key="titulo.periodo"/>
						</h2>
						<hr width="590" color="black" size="1" style="margin-left: 8px; margin-top: -4px;">
			            <div class="divForm" style="margin-top: 30px;">
			            	<table border="0" cellpadding="0" cellspacing="0" style="width: 590px;">
			            		<tr style="height: 40px;">
	            					<td style="width: 75px;">
	            						<f:message key="campo.checkIn"/>
	            					</td>
	            					<td colspan="2" style="width: 220px;">
            							<input type="hidden" class="k-textbox" value="${hotel.id}" name="reserva.hotel.id">
            							<div class="k-textbox k-space-right" style="width: 195px;">
							            	<input id="checkInReserva" type="text" name="reserva.dataPrevisaoCheckIn"/>
							                <span class="k-icon k-i-calendar"></span>
							            </div>
            						</td>
            						<td style="width: 75px;">
	            						<f:message key="campo.checkOut"/>
	            					</td>
            						<td colspan="2" style="width: 195px;">
            							<div class="k-textbox k-space-right" style="width: 195px;">
							            	<input id="checkOutReserva" type="text" name="reserva.dataPrevisaoCheckOut"/>
							                <span class="k-icon k-i-calendar"></span>
							            </div>
            						</td>
            					</tr>
            					<tr style="height: 40px;"></tr>
	            				<tr style="height: 20px;">
	            					<td colspan="6" style="text-align: center;">
	            						<f:message key="campo.checkOut.estendido.gratuito"/>
	            						<span style="margin: 15px;">
	            							<f:message key="sim"/>
	            							<input type="radio" name="reserva.checkOutEstendidoGratuito" value="true"/>
	            						</span>
	            						<span>
	            							<f:message key="nao"/>
	            							<input type="radio" name="reserva.checkOutEstendidoGratuito" value="false" checked/>
	            						</span>
	            					</td>
	            				</tr>
           					</table>
	            		</div>
           			</div>
	          		<div class="form" style="height: 200px;">
						<h2 class="StepTitle" style="margin: 0px;">
							<img class="linkSemBorda" src="../imagens/icones/iconeAcomodacao.png" style="margin-left: 5px; height: 12px;"/> <f:message key="titulo.acomodacao"/>
						</h2>
						<hr width="590" color="black" size="1" style="margin-left: 8px; margin-top: -4px;">
		            	<div class="divForm" style="margin-left: 10px; margin-top: 10px;">
			            	<div id="acomodacaoReservaList"></div>
			            </div>
		            </div>
		            <div class="form" style="height: 200px;">
						<h2 class="StepTitle" style="margin: 0px;">
							<img class="linkSemBorda" src="../imagens/icones/iconeAcomodacao.png" style="margin-left: 5px; height: 12px;"/> <f:message key="titulo.responsavel"/>
						</h2>
						<hr width="590" color="black" size="1" style="margin-left: 8px; margin-top: -4px;">
			            <div class="divForm">
			            	<table border="0" cellpadding="0" cellspacing="0" style="width: 580px;">
			            		<tr style="height: 10px;"></tr>
			            		<tr valign="bottom" style="height: 20px;">
			            			<td rowspan="12" style="width: 10px;"></td>
		            				<td colspan="3" style="width: 400px;">
		            					<f:message key="campo.nome.responsavel"/>
		            				</td>
		            				<td style="width: 160px;">
		            					<f:message key="campo.sexo.responsavel"/>
		            				</td>
	            				</tr>
	            				<tr style="height: 10px;">
	            					<td colspan="3" style="width: 400px;">
		            					<input id="nomeResponsavelReserva" type="text" class="k-textbox" name="responsavel.nome" style="width: 380px;"/>
		            				</td>
	            					<td style="width: 160px;">
	            						<select id="sexoReserva" name="responsavel.sexo" style="width: 160px; font-size: 11px;">
											<option value=""><f:message key="selecione"/></option>
											<option value="Masculino"><f:message key="masculino"/></option>
											<option value="Feminino"><f:message key="feminino"/></option>
										</select>
	            					</td>
	            				</tr>
	            				<tr valign="bottom" style="height: 25px;">
		            				<td style="width: 125px;">
		            					<f:message key="campo.rg.responsavel"/>
		            				</td>
		            				<td style="width: 130px;">
		            					<f:message key="campo.cpf.responsavel"/>
		            				</td>
		            				<td style="width: 135px;">
		            					<f:message key="campo.telefone.responsavel"/>
		            				</td>
		            				<td style="width: 160px;">
		            					<f:message key="campo.email.responsavel"/>
		            				</td>
	            				</tr>
	            				<tr style="height: 10px;">
	            					<td style="width: 125px;">
		            					<input id="rgReserva" type="text" class="k-textbox" name="responsavel.rg" style="width: 105px;"/>
		            				</td>
		            				<td style="width: 130px;">
		            					<input id="cpfReserva" type="text" class="k-textbox" name="responsavel.cpf" style="width: 110px;"/>
		            				</td>
		            				<td style="width: 135px;">
		            					<input id="telefoneReserva" type="text" class="k-textbox" name="responsavel.telefone" style="width: 115px;"/>
		            				</td>
		            				<td style="width: 160px;">
		            					<input id="emailReserva" type="text" class="k-textbox" name="responsavel.email" style="width: 160px;"/>
		            				</td>
	            				</tr>
	            			</table>
		            	</div>
	           		</div>
	           		<div class="form" style="height: 200px;">
						<h2 class="StepTitle" style="margin: 0px;">
							<img class="linkSemBorda" src="../imagens/icones/iconeAcomodacao.png" style="margin-left: 5px; height: 12px;"/> <f:message key="titulo.confirmar"/>
						</h2>
						<hr width="590" color="black" size="1" style="margin-left: 8px; margin-top: -4px;">
			            <div class="divForm" style="float: left; width: 270px; height: 70px;">
			            	<table border="0" cellpadding="0" cellspacing="0" style="width: 280px;">
			            		<tr style="height: 25px;">
		            				<td style="width: 130px;">
		            					<f:message key="campo.horario.checkIn"/>
		            				</td>
		            				<td style="width: 150px;">
		            					<input id="exibirCheckInReserva" type="text" style="width: 145px; border: 0px; background: none;" disabled/>
		            				</td>
	            				</tr>
	            				<tr style="height: 25px;">
	            					<td style="width: 130px;">
		            					<f:message key="campo.acomodacao"/>
		            				</td>
	            					<td style="width: 150px;">
	            						<input id="exibirNumeroReserva" type="text" style="float: left; width: 40px; border: 0px; background: none;" disabled>
	            						<input id="exibirNomeReserva" type="text" style="float: left; width: 100px; border: 0px; background: none;" disabled>
	            					</td>
	            				</tr>
	            				<tr style="height: 25px;">
	            					<td style="width: 130px;">
		            					<f:message key="campo.valor.total"/>:
		            				</td>
	            					<td style="width: 150px;">
	            						<input id="exibirValorTotalReserva" type="text" style="width: 145px; border: 0px; background: none;" disabled>
	            					</td>
	            				</tr>
	            			</table>
		            	</div>
		            	<div class="divForm" style="float: left; width: 270px; height: 70px;">
			            	<table border="0" cellpadding="0" cellspacing="0" style="width: 280px;">
	            				<tr style="height: 25px;">
	            					<td style="width: 130px;">
		            					<f:message key="campo.horario.checkOut"/>
		            				</td>
	            					<td style="width: 150px;">
	            						<input id="exibirCheckOutReserva" type="text" style="width: 145px; border: 0px; background: none;" disabled/>
	            					</td>
	            				</tr>
	            				<tr style="height: 25px;">
	            					<td style="width: 130px;">
		            					<f:message key="campo.responsavel"/>:
		            				</td>
	            					<td style="width: 150px;">
	            						<input id="exibirResponsavelReserva" type="text" style="float: left; width: 145px; border: 0px; background: none;" disabled>
	            					</td>
	            				</tr>
	            			</table>
		            	</div>
		            	<div class="divForm" style="float: left; height: 70px;">
			            	<table border="0" cellpadding="0" cellspacing="0" style="width: 580px;">
	            				<tr valign="bottom" style="height: 25px;">
	            					<td colspan="4" style="width: 580px;">
		            					<f:message key="campo.observacoes"/>
		            				</td>
	            				</tr>
	            				<tr style="height: 25px;">
	            					<td colspan="4" style="width: 580px;">
	            						<textarea class="k-textbox" name="reserva.observacao" style="width: 560px; height: 40px; font-size: 11px;"></textarea>
	            					</td>
	            				</tr>
	            			</table>
		            	</div>
	           		</div>
	       	 	</div>
	  		</form>
	  	</div>
	</body>
</html>